<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∏ñÁïåÁ¥õ‰∫â„Éû„ÉÉ„Éó</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #0a0e27;
            color: #fff;
            overflow: hidden;
        }

        #root {
            width: 100vw;
            height: 100vh;
            height: 100dvh; /* „É¢„Éê„Ç§„É´„Éñ„É©„Ç¶„Ç∂ÂØæÂøú */
        }

        .container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .header {
            background: rgba(10, 14, 39, 0.95);
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            z-index: 2;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 20px;
            flex-wrap: wrap;
        }

        .header-text {
            flex: 1;
            min-width: 200px;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .header p {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
        }

        .filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .filter-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 6px 12px;
            color: #fff;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 120px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 16px;
            padding-right: 32px;
        }

        .filter-select:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .filter-select:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.15);
        }

        .filter-select option {
            background: #1a1f3a;
            color: #fff;
            padding: 8px;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            color: #fff;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .refresh-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .refresh-btn:active {
            transform: translateY(0);
        }

        .refresh-btn.loading {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .stats {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(10, 14, 39, 0.95);
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            z-index: 1;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .stats-number {
            font-size: 20px;
            font-weight: 700;
            color: #fff;
            margin-right: 4px;
        }

        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(10, 14, 39, 0.95);
            padding: 16px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            z-index: 1;
            max-width: calc(100vw - 40px);
            transition: all 0.3s ease;
        }
        
        /* „É¢„Éê„Ç§„É´Áî®Ôºö„Ç≥„É≥„Éë„ÇØ„Éà„Å™Âá°‰æã */
        @media (max-width: 767px) {
            .legend {
                bottom: 80px;
                right: 10px;
                padding: 0;
                border: none;
                background: transparent;
                backdrop-filter: none;
            }
            
            .legend.collapsed .legend-content {
                display: none;
            }
            
            .legend.collapsed .legend-toggle {
                background: rgba(10, 14, 39, 0.95);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .legend:not(.collapsed) .legend-toggle {
                display: none;
            }
            
            .legend:not(.collapsed) .legend-content {
                background: rgba(10, 14, 39, 0.95);
                border: 1px solid rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                padding: 12px;
                border-radius: 10px;
            }
        }
        
        .legend-toggle {
            display: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(10, 14, 39, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            cursor: pointer;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.2s;
        }
        
        @media (max-width: 767px) {
            .legend.collapsed .legend-toggle {
                display: flex;
            }
        }
        
        .legend-toggle:active {
            transform: scale(0.95);
        }

        .legend h3 {
            font-size: 13px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        @media (max-width: 767px) {
            .legend h3 {
                font-size: 12px;
                margin-bottom: 8px;
            }
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            font-size: 12px;
        }
        
        @media (max-width: 767px) {
            .legend-item {
                font-size: 11px;
                margin-bottom: 5px;
            }
        }

        .legend-item:last-child {
            margin-bottom: 0;
        }

        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 8px;
            flex-shrink: 0;
        }
        
        @media (max-width: 767px) {
            .legend-color {
                width: 12px;
                height: 12px;
                margin-right: 6px;
            }
        }
        
        .legend-close {
            display: none;
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            line-height: 1;
        }
        
        @media (max-width: 767px) {
            .legend:not(.collapsed) .legend-close {
                display: block;
            }
        }
        
        .legend-close:active {
            color: rgba(255, 255, 255, 1);
        }

        #map {
            flex: 1;
            width: 100%;
            touch-action: none; /* „Çø„ÉÉ„ÉÅÊìç‰Ωú„ÇíÊúÄÈÅ©Âåñ */
            cursor: grab; /* „Éâ„É©„ÉÉ„Ç∞ÂèØËÉΩ„Åß„ÅÇ„Çã„Åì„Å®„ÇíÁ§∫„Åô */
        }

        #map:active {
            cursor: grabbing; /* „Éâ„É©„ÉÉ„Ç∞‰∏≠„ÅÆ„Ç´„Éº„ÇΩ„É´ */
        }

        /* „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„Ç≥„É≥„Éà„É≠„Éº„É´„ÅÆ„Çπ„Çø„Ç§„É´Ë™øÊï¥ */
        .mapboxgl-ctrl-top-right {
            top: 80px;
            right: 20px;
        }

        .mapboxgl-ctrl-group {
            background: rgba(10, 14, 39, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .mapboxgl-ctrl-group button {
            background-color: transparent;
            border-color: rgba(255, 255, 255, 0.1);
        }

        .mapboxgl-ctrl-group button + button {
            border-top-color: rgba(255, 255, 255, 0.1);
        }

        .mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon,
        .mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon,
        .mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon {
            background-color: rgba(255, 255, 255, 0.9);
        }

        .mapboxgl-ctrl-group button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .mapboxgl-popup {
            max-width: none !important;
        }
        
        .mapboxgl-popup-content {
            background: rgba(10, 14, 39, 0.98);
            color: #fff;
            border-radius: 12px;
            padding: 16px;
            max-width: 320px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
        }
        
        /* „É¢„Éê„Ç§„É´Â∞ÇÁî®„ÅÆÊúÄÈÅ©Âåñ */
        @media (max-width: 767px) {
            .mapboxgl-popup-content {
                max-width: 280px;
                max-height: 65vh;
                overflow-y: auto;
                padding: 14px;
            }
            
            /* „Çπ„ÇØ„É≠„Éº„É´„Éê„Éº„ÅÆ„Çπ„Çø„Ç§„É´ */
            .mapboxgl-popup-content::-webkit-scrollbar {
                width: 4px;
            }
            
            .mapboxgl-popup-content::-webkit-scrollbar-thumb {
                background: rgba(255, 255, 255, 0.3);
                border-radius: 2px;
            }
        }

        .mapboxgl-popup-close-button {
            color: #fff;
            font-size: 22px;
            padding: 4px 8px;
            line-height: 1;
            width: 30px;
            height: 30px;
            right: 6px;
            top: 6px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }
        
        /* „É¢„Éê„Ç§„É´„ÅßÈñâ„Åò„Çã„Éú„Çø„É≥„ÇíÂ∞ë„ÅóÂ§ß„Åç„Åè */
        @media (max-width: 767px) {
            .mapboxgl-popup-close-button {
                font-size: 24px;
                width: 34px;
                height: 34px;
            }
        }

        .mapboxgl-popup-close-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .popup-title {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 8px;
            line-height: 1.3;
            padding-right: 20px;
        }

        .popup-location {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 8px;
        }

        .popup-severity {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .popup-description {
            font-size: 13px;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 8px;
        }

        .popup-date {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 6px;
            margin-bottom: 8px;
        }
        
        .popup-meta {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 6px;
        }
        
        .article-link-button {
            display: block;
            width: 100%;
            text-align: center;
            margin-top: 10px;
            padding: 10px 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 7px;
            font-size: 13px;
            font-weight: 600;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.4);
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }
        
        /* „É¢„Éê„Ç§„É´„Åß„Éú„Çø„É≥„ÇíÂ∞ë„ÅóÂ§ß„Åç„Åè */
        @media (max-width: 767px) {
            .article-link-button {
                padding: 12px 16px;
                font-size: 14px;
            }
        }
        
        .article-link-button:active {
            transform: scale(0.97);
            box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
        }

        .marker {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .marker:active {
            transform: scale(1.2);
        }

        .marker-pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        /* „Çø„Éñ„É¨„ÉÉ„ÉàÂØæÂøú */
        @media (min-width: 768px) {
            .header {
                padding: 20px 30px;
            }

            .header h1 {
                font-size: 24px;
                margin-bottom: 8px;
            }

            .header p {
                font-size: 14px;
            }

            .stats {
                top: 90px;
            }

            .legend {
                bottom: 30px;
                right: 30px;
                padding: 20px;
            }

            .legend h3 {
                font-size: 14px;
                margin-bottom: 12px;
            }

            .legend-item {
                font-size: 13px;
                margin-bottom: 8px;
            }

            .legend-color {
                width: 16px;
                height: 16px;
                margin-right: 10px;
            }

            .mapboxgl-popup-content {
                min-width: 280px;
                padding: 16px;
            }

            .popup-title {
                font-size: 16px;
                margin-bottom: 8px;
            }

            .popup-location {
                font-size: 13px;
                margin-bottom: 12px;
            }

            .popup-severity {
                font-size: 12px;
                margin-bottom: 12px;
            }

            .popup-date {
                font-size: 12px;
            }

            .marker:hover {
                transform: scale(1.3);
            }
        }

        /* „Éá„Çπ„ÇØ„Éà„ÉÉ„ÉóÂØæÂøú */
        @media (min-width: 1024px) {
            .legend {
                max-width: 300px;
            }
        }

        /* Â∞è„Åï„Å™„Çπ„Éû„ÉõÂØæÂøú */
        @media (max-width: 360px) {
            .header h1 {
                font-size: 18px;
            }

            .header p {
                font-size: 12px;
            }

            .legend {
                bottom: 15px;
                right: 15px;
                padding: 12px;
            }

            .legend h3 {
                font-size: 12px;
            }

            .legend-item {
                font-size: 11px;
            }

            .popup-title {
                font-size: 14px;
            }
        }

        /* „É©„É≥„Éâ„Çπ„Ç±„Éº„Éó„É¢„Éº„ÉâÔºàÊ®™Âêë„ÅçÔºâÂØæÂøú */
        @media (max-height: 500px) and (orientation: landscape) {
            .header {
                padding: 12px 20px;
            }

            .header h1 {
                font-size: 16px;
                margin-bottom: 2px;
            }

            .header p {
                font-size: 11px;
            }

            .legend {
                bottom: 10px;
                right: 10px;
                padding: 10px;
                font-size: 11px;
            }

            .legend h3 {
                font-size: 11px;
                margin-bottom: 6px;
            }

            .legend-item {
                font-size: 10px;
                margin-bottom: 4px;
            }

            .legend-color {
                width: 12px;
                height: 12px;
                margin-right: 6px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // „Ç§„Éô„É≥„Éà„Ç´„ÉÜ„Ç¥„É™„ÅÆÂÆöÁæ©
        const categories = {
            all: '„Åô„Åπ„Å¶',
            conflict: 'Ê≠¶ÂäõÁ¥õ‰∫â',
            protest: 'ÊäóË≠∞„Éª„Éá„É¢',
            political: 'ÊîøÊ≤ªÁöÑÁ∑äÂºµ',
            humanitarian: '‰∫∫ÈÅìÂç±Ê©ü',
            diplomatic: 'Â§ñ‰∫§ÂïèÈ°å'
        };

        const severityColors = {
            critical: '#ff0040',
            high: '#ff6b00',
            medium: '#ffc107',
            low: '#4caf50'
        };

        const severityLabels = {
            critical: 'Á∑äÊÄ•',
            high: 'È´ò',
            medium: '‰∏≠',
            low: '‰Ωé'
        };

        // Ë§áÊï∞„ÅÆ„Éã„É•„Éº„Çπ„ÇΩ„Éº„Çπ„Åã„ÇâÁµ±ÂêàÂèñÂæóÔºà‰∏ñÁïå‰∏≠„Çí„Ç´„Éê„ÉºÔºâ
        async function fetchGDELTEvents() {
            try {
                console.log('üì° Fetching news from multiple global sources...');
                
                const corsProxy = 'https://api.allorigins.win/raw?url=';
                
                // Ë§áÊï∞„ÅÆRSS„ÇΩ„Éº„ÇπÔºàÂú∞Âüü„Éê„É©„É≥„Çπ„ÇíËÄÉÊÖÆÔºâ
                const sources = [
                    {
                        name: 'Al Jazeera',
                        url: 'https://www.aljazeera.com/xml/rss/all.xml',
                        strength: '‰∏≠Êù±„Éª„Ç¢„Ç∏„Ç¢'
                    },
                    {
                        name: 'BBC World',
                        url: 'https://feeds.bbci.co.uk/news/world/rss.xml',
                        strength: 'ÂÖ®‰∏ñÁïå„Éê„É©„É≥„Çπ'
                    },
                    {
                        name: 'Reuters',
                        url: 'https://www.reutersagency.com/feed/',
                        strength: 'ÂÖ®‰∏ñÁïå„ÉªÈÄüÂ†±'
                    }
                ];
                
                // ÂÖ®„ÇΩ„Éº„Çπ„Åã„Çâ‰∏¶Âàó„ÅßÂèñÂæó
                const allArticles = [];
                
                for (const source of sources) {
                    try {
                        const response = await fetch(corsProxy + encodeURIComponent(source.url));
                        const text = await response.text();
                        const parser = new DOMParser();
                        const xml = parser.parseFromString(text, 'text/xml');
                        const items = xml.querySelectorAll('item');
                        
                        items.forEach((item, index) => {
                            if (index >= 20) return; // ÂêÑ„ÇΩ„Éº„ÇπÊúÄÂ§ß20‰ª∂
                            
                            allArticles.push({
                                title: item.querySelector('title')?.textContent || '',
                                link: item.querySelector('link')?.textContent || '',
                                description: item.querySelector('description')?.textContent || '',
                                pubDate: item.querySelector('pubDate')?.textContent || '',
                                source: source.name
                            });
                        });
                        
                        console.log(`‚úÖ ${source.name}: ${Math.min(20, items.length)} articles`);
                    } catch (err) {
                        console.warn(`‚ö†Ô∏è ${source.name} failed:`, err.message);
                    }
                }
                
                console.log(`üì∞ Total articles fetched: ${allArticles.length}`);
                
                const events = [];
                
                // ‰∏ñÁïå‰∏≠„ÅÆ‰ΩçÁΩÆÊÉÖÂ†±„Éû„ÉÉ„Éî„É≥„Ç∞ÔºàÂ§ßÂπÖÊã°ÂÖÖÔºâ
                const locations = {
                    // „É®„Éº„É≠„ÉÉ„Éë
                    'Ukraine': { lat: 48.3794, lng: 31.1656 },
                    'Kyiv': { lat: 50.4501, lng: 30.5234 },
                    'Russia': { lat: 55.7558, lng: 37.6173 },
                    'Moscow': { lat: 55.7558, lng: 37.6173 },
                    'Paris': { lat: 48.8566, lng: 2.3522 },
                    'France': { lat: 46.2276, lng: 2.2137 },
                    'Germany': { lat: 51.1657, lng: 10.4515 },
                    'UK': { lat: 55.3781, lng: -3.4360 },
                    'Poland': { lat: 51.9194, lng: 19.1451 },
                    
                    // ‰∏≠Êù±
                    'Gaza': { lat: 31.5, lng: 34.45 },
                    'Israel': { lat: 31.0461, lng: 34.8516 },
                    'Palestine': { lat: 31.9522, lng: 35.2332 },
                    'West Bank': { lat: 31.9, lng: 35.2 },
                    'Rafah': { lat: 31.2858, lng: 34.2458 },
                    'Iran': { lat: 32.4279, lng: 53.6880 },
                    'Tehran': { lat: 35.6892, lng: 51.3890 },
                    'Iraq': { lat: 33.2232, lng: 43.6793 },
                    'Baghdad': { lat: 33.3152, lng: 44.3661 },
                    'Syria': { lat: 34.8021, lng: 38.9968 },
                    'Damascus': { lat: 33.5138, lng: 36.2765 },
                    'Lebanon': { lat: 33.8547, lng: 35.8623 },
                    'Beirut': { lat: 33.8886, lng: 35.4955 },
                    'Yemen': { lat: 15.5527, lng: 48.5164 },
                    'Saudi Arabia': { lat: 23.8859, lng: 45.0792 },
                    'Qatar': { lat: 25.3548, lng: 51.1839 },
                    'Doha': { lat: 25.2854, lng: 51.5310 },
                    
                    // „Ç¢„Éï„É™„Ç´
                    'Sudan': { lat: 15.5007, lng: 32.5599 },
                    'Khartoum': { lat: 15.5007, lng: 32.5599 },
                    'Ethiopia': { lat: 9.1450, lng: 40.4897 },
                    'Somalia': { lat: 5.1521, lng: 46.1996 },
                    'Libya': { lat: 26.3351, lng: 17.2283 },
                    'Mali': { lat: 17.5707, lng: -3.9962 },
                    'Nigeria': { lat: 9.0820, lng: 8.6753 },
                    'Kenya': { lat: -0.0236, lng: 37.9062 },
                    'Congo': { lat: -4.0383, lng: 21.7587 },
                    'Zimbabwe': { lat: -19.0154, lng: 29.1549 },
                    
                    // „Ç¢„Ç∏„Ç¢
                    'Myanmar': { lat: 21.9162, lng: 95.9560 },
                    'Afghanistan': { lat: 33.9391, lng: 67.7100 },
                    'Kabul': { lat: 34.5553, lng: 69.2075 },
                    'Pakistan': { lat: 30.3753, lng: 69.3451 },
                    'India': { lat: 20.5937, lng: 78.9629 },
                    'Kashmir': { lat: 34.0837, lng: 74.7973 },
                    'China': { lat: 35.8617, lng: 104.1954 },
                    'Taiwan': { lat: 23.6978, lng: 120.9605 },
                    'North Korea': { lat: 40.3399, lng: 127.5101 },
                    'South Korea': { lat: 37.5665, lng: 126.9780 },
                    'Seoul': { lat: 37.5665, lng: 126.9780 },
                    'Japan': { lat: 36.2048, lng: 138.2529 },
                    'Philippines': { lat: 12.8797, lng: 121.7740 },
                    
                    // ÂçóÂåóÁ±≥ÔºàÈáçÁÇπËøΩÂä†Ôºâ
                    'Venezuela': { lat: 10.4806, lng: -66.9036 },
                    'Caracas': { lat: 10.4806, lng: -66.9036 },
                    'Colombia': { lat: 4.5709, lng: -74.2973 },
                    'Bogota': { lat: 4.7110, lng: -74.0721 },
                    'Brazil': { lat: -14.2350, lng: -51.9253 },
                    'Sao Paulo': { lat: -23.5505, lng: -46.6333 },
                    'Ecuador': { lat: -1.8312, lng: -78.1834 },
                    'Peru': { lat: -9.1900, lng: -75.0152 },
                    'Chile': { lat: -35.6751, lng: -71.5430 },
                    'Argentina': { lat: -38.4161, lng: -63.6167 },
                    'Mexico': { lat: 23.6345, lng: -102.5528 },
                    'Honduras': { lat: 15.2000, lng: -86.2419 },
                    'Haiti': { lat: 18.9712, lng: -72.2852 },
                    'Cuba': { lat: 21.5218, lng: -77.7812 },
                    'United States': { lat: 37.0902, lng: -95.7129 },
                    'USA': { lat: 37.0902, lng: -95.7129 },
                    'Canada': { lat: 56.1304, lng: -106.3468 },
                    
                    // „Ç™„Çª„Ç¢„Éã„Ç¢
                    'Australia': { lat: -25.2744, lng: 133.7751 },
                    'Sydney': { lat: -33.8688, lng: 151.2093 },
                    'New Zealand': { lat: -40.9006, lng: 174.8860 }
                };
                
                // Á¥õ‰∫âÈñ¢ÈÄ£„Ç≠„Éº„ÉØ„Éº„ÉâÔºàÊã°ÂÖÖÔºâ
                const conflictKeywords = [
                    'war', 'conflict', 'attack', 'killed', 'death', 'violence', 
                    'protest', 'crisis', 'military', 'strike', 'bombing', 'airstrike',
                    'coup', 'rebellion', 'insurgency', 'militia', 'armed', 'fighting',
                    'clashes', 'siege', 'blockade', 'invasion', 'occupation'
                ];
                
                allArticles.forEach(article => {
                    const { title, link, description, pubDate, source } = article;
                    const content = (title + ' ' + description).toLowerCase();
                    
                    // Á¥õ‰∫âÈñ¢ÈÄ£„ÅÆ„Åø
                    if (!conflictKeywords.some(kw => content.includes(kw))) {
                        return;
                    }
                    
                    // ‰ΩçÁΩÆÊÉÖÂ†±„ÇíÊäΩÂá∫ÔºàÂ§ßÊñáÂ≠óÂ∞èÊñáÂ≠ó„ÇíÂå∫Âà•„Åó„Å™„ÅÑÔºâ
                    let locationName = null;
                    let coords = null;
                    
                    for (const [loc, coord] of Object.entries(locations)) {
                        if (content.includes(loc.toLowerCase())) {
                            locationName = loc;
                            coords = coord;
                            break;
                        }
                    }
                    
                    if (!coords) {
                        console.log(`‚ö†Ô∏è No location found for: ${title.substring(0, 50)}...`);
                        return; // ‰ΩçÁΩÆ‰∏çÊòé„ÅØ„Çπ„Ç≠„ÉÉ„Éó
                    }
                    
                    // Ê∑±ÂàªÂ∫¶„ÇíÂà§ÂÆö
                    let severity = 'low';
                    if (content.match(/killed|death|massacre|bombing|airstrike|genocide/)) {
                        severity = 'critical';
                    } else if (content.match(/attack|military|war|violence|strike|coup/)) {
                        severity = 'high';
                    } else if (content.match(/protest|tension|dispute|clashes/)) {
                        severity = 'medium';
                    }
                    
                    // „Ç´„ÉÜ„Ç¥„É™„ÇíÂà§ÂÆö
                    let category = 'conflict';
                    if (content.includes('protest') || content.includes('demonstration')) {
                        category = 'protest';
                    } else if (content.includes('humanitarian') || content.includes('refugee') || content.includes('aid')) {
                        category = 'humanitarian';
                    } else if (content.includes('diplomatic') || content.includes('talks') || content.includes('negotiation')) {
                        category = 'diplomatic';
                    } else if (content.includes('political') || content.includes('election') || content.includes('tension')) {
                        category = 'political';
                    }
                    
                    // Êó•‰ªò„Çí„Éï„Ç©„Éº„Éû„ÉÉ„Éà
                    const date = pubDate ? new Date(pubDate).toISOString().split('T')[0] : new Date().toISOString().split('T')[0];
                    
                    events.push({
                        id: events.length + 1,
                        title: title.substring(0, 100),
                        location: locationName,
                        lat: coords.lat,
                        lng: coords.lng,
                        severity: severity,
                        description: description.replace(/<[^>]*>/g, '').substring(0, 200),
                        date: date,
                        category: category,
                        sources: 1,
                        articleUrl: link,
                        sourceName: source
                    });
                });
                
                console.log(`üåç Successfully processed ${events.length} conflict events from ${sources.length} sources`);
                console.log(`üìä Coverage: Middle East, Asia, Africa, Americas, Europe, Oceania`);
                
                if (events.length === 0) {
                    console.warn('‚ö†Ô∏è No events matched criteria (conflict keywords + location found)');
                }
                
                return events; // ÂèñÂæó„Åó„Åü„Ç§„Éô„É≥„Éà„ÇíËøî„ÅôÔºàÂ±•Ê≠¥„Å´ËøΩÂä†„Åï„Çå„ÇãÔºâ
                
            } catch (error) {
                console.error('‚ùå Error fetching news:', error);
                console.log('‚ö†Ô∏è No events fetched, returning empty array');
                return []; // „Ç®„É©„ÉºÊôÇ„ÅØÁ©∫ÈÖçÂàó„ÇíËøî„Åô
            }
        }

        function ConflictMap() {
            const mapContainer = useRef(null);
            const map = useRef(null);
            const markers = useRef([]);
            const [loaded, setLoaded] = useState(false);
            const [events, setEvents] = useState([]);
            const [loading, setLoading] = useState(false);
            const [categoryFilter, setCategoryFilter] = useState('all');
            const [severityFilter, setSeverityFilter] = useState('all');
            const [legendCollapsed, setLegendCollapsed] = useState(true); // „É¢„Éê„Ç§„É´„Åß„ÅØ„Éá„Éï„Ç©„É´„Éà„ÅßÈñâ„Åò„Çã

            // „Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Åï„Çå„Åü„Ç§„Éô„É≥„Éà
            const filteredEvents = events.filter(event => {
                const categoryMatch = categoryFilter === 'all' || event.category === categoryFilter;
                const severityMatch = severityFilter === 'all' || event.severity === severityFilter;
                return categoryMatch && severityMatch;
            });

            // ÈÅéÂéª„ÅÆ„Ç§„Éô„É≥„Éà„ÇíËìÑÁ©çÔºàÊúÄÂ§ß20‰ª∂Ôºâ
            const eventHistory = useRef([]);
            
            // „Ç§„Éô„É≥„Éà„Éá„Éº„Çø„ÇíÂèñÂæó
            const loadEvents = async () => {
                setLoading(true);
                console.log('Loading events...');
                try {
                    const newData = await fetchGDELTEvents();
                    console.log('New events loaded:', newData.length, 'events');
                    
                    // Êñ∞„Åó„ÅÑ„Ç§„Éô„É≥„Éà„ÇíÂ±•Ê≠¥„Å´ËøΩÂä†Ôºà„Çø„Ç§„Éà„É´+URL„ÅßÈáçË§á„ÇíÈÅø„Åë„ÇãÔºâ
                    const existingKeys = new Set(
                        eventHistory.current.map(e => `${e.title}-${e.articleUrl}`)
                    );
                    const uniqueNewEvents = newData.filter(e => 
                        !existingKeys.has(`${e.title}-${e.articleUrl}`)
                    );
                    
                    console.log(`üÜï New unique events: ${uniqueNewEvents.length}`);
                    
                    // Â±•Ê≠¥„ÇíÊõ¥Êñ∞ÔºàÊñ∞„Åó„ÅÑ„Ç§„Éô„É≥„Éà„ÇíÂÖàÈ†≠„Å´ËøΩÂä†Ôºâ
                    eventHistory.current = [...uniqueNewEvents, ...eventHistory.current];
                    
                    // ÊúÄÂ§ß20‰ª∂„Å´Âà∂Èôê
                    if (eventHistory.current.length > 20) {
                        const removed = eventHistory.current.length - 20;
                        eventHistory.current = eventHistory.current.slice(0, 20);
                        console.log(`üóëÔ∏è Removed ${removed} old events`);
                    }
                    
                    // ID„ÇíÂÜçÊé°Áï™ÔºàÂ±•Ê≠¥ÂÖ®‰Ωì„Åß‰∏ÄÊÑè„Å´„Åô„ÇãÔºâ
                    eventHistory.current = eventHistory.current.map((event, index) => ({
                        ...event,
                        id: index + 1
                    }));
                    
                    console.log(`üìö Total events in history: ${eventHistory.current.length}`);
                    console.log(`üó∫Ô∏è Displaying all ${eventHistory.current.length} events on map`);
                    
                    // Â±•Ê≠¥„ÅÆÂÖ®„Ç§„Éô„É≥„Éà„ÇíË°®Á§∫
                    setEvents(eventHistory.current);
                } catch (error) {
                    console.error('„Ç§„Éô„É≥„Éà„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
                    // „Ç®„É©„ÉºÊôÇ„ÇÇÊó¢Â≠ò„ÅÆÂ±•Ê≠¥„ÅØ‰øùÊåÅ
                    if (eventHistory.current.length > 0) {
                        console.log(`üìã Keeping existing ${eventHistory.current.length} events`);
                        setEvents(eventHistory.current);
                    }
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                if (map.current) return;

                // Mapbox„Ç¢„ÇØ„Çª„Çπ„Éà„Éº„ÇØ„É≥
                mapboxgl.accessToken = 'pk.eyJ1IjoieXV1czI0IiwiYSI6ImNtbGpkNnZndzBjc3kzZ29kcGJieGM1amwifQ.D_MBoSrs0EYhqk13xiRBxg';

                map.current = new mapboxgl.Map({
                    container: mapContainer.current,
                    style: 'mapbox://styles/mapbox/dark-v11',
                    center: [40, 25],
                    zoom: window.innerWidth < 768 ? 1.8 : 2.2,
                    projection: 'globe', // Âú∞ÁêÉÂÑÄ„Å´Êàª„Åô
                    attributionControl: false,
                    dragRotate: false,
                    touchZoomRotate: true,
                    touchPitch: false,
                    fadeDuration: 0,
                    pitchWithRotate: false,
                    dragPan: true,
                    keyboard: true,
                    doubleClickZoom: true,
                    scrollZoom: false,
                    boxZoom: false,
                    renderWorldCopies: true,
                    trackResize: true,
                    bearingSnap: 0
                });

                map.current.on('load', () => {
                    setLoaded(true);
                    
                    map.current.addControl(new mapboxgl.NavigationControl({
                        showCompass: false,
                        showZoom: true,
                        visualizePitch: false
                    }), 'top-right');
                    
                    // Âú∞ÁêÉÂÑÄ„ÅÆÈúßÂäπÊûú„ÇíÊàª„Åô
                    map.current.setFog({
                        color: 'rgb(186, 210, 235)',
                        'high-color': 'rgb(36, 92, 223)',
                        'horizon-blend': 0.02,
                        'space-color': 'rgb(11, 11, 25)',
                        'star-intensity': 0.6
                    });
                    
                    // „Éâ„É©„ÉÉ„Ç∞„ÅÆÊÖ£ÊÄß„ÇíÂº∑Âåñ
                    map.current.dragPan.enable({
                        linearity: 0.3,
                        easing: t => t * (2 - t),
                        maxSpeed: 1400,
                        deceleration: 2500
                    });
                    
                    // „Ç´„Çπ„Çø„É†„Éõ„Ç§„Éº„É´„Éè„É≥„Éâ„É©„Éº
                    const mapElement = mapContainer.current;
                    mapElement.addEventListener('wheel', (e) => {
                        // ctrlKeyÔºàMac„Åß„ÅØ‚åòÔºâ„ÅåÊäº„Åï„Çå„Å¶„ÅÑ„Çã„ÄÅ„Åæ„Åü„ÅØ„Éî„É≥„ÉÅ„Ç∏„Çß„Çπ„ÉÅ„É£„Éº„ÅÆÂ†¥Âêà„ÅØ„Ç∫„Éº„É†
                        if (e.ctrlKey || e.metaKey) {
                            e.preventDefault();
                            const zoom = map.current.getZoom();
                            const delta = -e.deltaY / 100; // „Ç∫„Éº„É†Èáè„ÇíË™øÊï¥
                            map.current.zoomTo(zoom + delta, {
                                duration: 0
                            });
                            return;
                        }
                        
                        e.preventDefault();
                        
                        const center = map.current.getCenter();
                        const zoom = map.current.getZoom();
                        
                        // „Çπ„ÇØ„É≠„Éº„É´Èáè„Å´Âü∫„Å•„ÅÑ„Å¶ÁßªÂãïË∑ùÈõ¢„ÇíË®àÁÆó
                        const panFactor = 0.5 / Math.pow(2, zoom);
                        
                        // Á∏¶„Çπ„ÇØ„É≠„Éº„É´Ôºà‰∏ªÔºâ„Å®Ê®™„Çπ„ÇØ„É≠„Éº„É´ÔºàShiftÊäº‰∏ãÊôÇÔºâ„Å´ÂØæÂøú
                        const deltaX = e.shiftKey ? e.deltaY * panFactor : e.deltaX * panFactor;
                        const deltaY = e.shiftKey ? 0 : e.deltaY * panFactor;
                        
                        map.current.panTo([
                            center.lng + deltaX,
                            center.lat - deltaY
                        ], {
                            duration: 0
                        });
                    }, { passive: false });
                    
                    // ÂàùÂõû„Ç§„Éô„É≥„ÉàË™≠„ÅøËæº„Åø
                    loadEvents();
                    
                    console.log('Map loaded, loading events...');
                    
                    // 15ÂàÜ„Åî„Å®„Å´Ëá™ÂãïÊõ¥Êñ∞
                    const autoRefreshInterval = setInterval(() => {
                        console.log('üîÑ Auto-refreshing events (every 15 minutes)...');
                        loadEvents();
                    }, 15 * 60 * 1000); // 15ÂàÜ = 900,000„Éü„É™Áßí
                    
                    // „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÊôÇ„Å´ÈñìÈöî„Çø„Ç§„Éû„Éº„Çí„ÇØ„É™„Ç¢
                    return () => clearInterval(autoRefreshInterval);
                });

                return () => {
                    if (map.current) {
                        map.current.remove();
                    }
                };
            }, []);

            // „Éï„Ç£„É´„Çø„ÉºÂ§âÊõ¥ÊôÇ„Å´„Éû„Éº„Ç´„Éº„ÇíÊõ¥Êñ∞
            useEffect(() => {
                if (!loaded || !map.current) return;

                console.log('Updating markers. Filtered events:', filteredEvents.length);

                // Êó¢Â≠ò„ÅÆ„Éû„Éº„Ç´„Éº„Çí„ÇØ„É™„Ç¢
                markers.current.forEach(marker => marker.remove());
                markers.current = [];

                // „Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Åï„Çå„Åü„Ç§„Éô„É≥„Éà„Å´„Éû„Éº„Ç´„Éº„ÇíËøΩÂä†
                filteredEvents.forEach(event => {
                    console.log('Creating marker for:', event.title, 'at [lng:', event.lng, ', lat:', event.lat, ']');
                    
                    // „Éû„Éº„Ç´„ÉºË¶ÅÁ¥†„Çí‰ΩúÊàê
                    const el = document.createElement('div');
                    
                    // ÈÅ©Âàá„Å™„Éû„Éº„Ç´„Éº„Çµ„Ç§„Ç∫
                    const isMobile = window.innerWidth < 768;
                    const criticalSize = isMobile ? 32 : 28;
                    const normalSize = isMobile ? 26 : 22;
                    const size = event.severity === 'critical' ? criticalSize : normalSize;
                    
                    Object.assign(el.style, {
                        width: size + 'px',
                        height: size + 'px',
                        backgroundColor: severityColors[event.severity],
                        borderRadius: '50%',
                        border: '2px solid white',
                        cursor: 'pointer',
                        boxShadow: `0 0 15px ${severityColors[event.severity]}`,
                        transition: 'transform 0.2s'
                    });
                    
                    console.log('Marker element created with size:', size);

                    // „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Çí‰ΩúÊàêÔºà„É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøúÔºâ
                    const popup = new mapboxgl.Popup({ 
                        offset: 30,
                        closeButton: true,
                        closeOnClick: false,
                        maxWidth: isMobile ? '280px' : '320px'
                    }).setHTML(`
                        <div class="popup-title">${event.title}</div>
                        <div class="popup-location">üìç ${event.location}</div>
                        <div class="popup-severity" style="background: ${severityColors[event.severity]}">
                            ${severityLabels[event.severity]}
                        </div>
                        <div class="popup-description">${event.description}</div>
                        <div class="popup-meta">
                            ${categories[event.category]} ‚Ä¢ ${event.sources}‰ª∂
                        </div>
                        <div class="popup-date">${event.date}</div>
                        ${event.articleUrl ? `
                            <a href="${event.articleUrl}" 
                               target="_blank" 
                               rel="noopener noreferrer" 
                               class="article-link-button"
                               onclick="event.stopPropagation();">
                                üì∞ Ë®ò‰∫ã„ÇíË™≠„ÇÄ
                            </a>
                        ` : ''}
                    `);

                    // Mapbox„Éû„Éº„Ç´„Éº„Çí‰ΩúÊàê
                    try {
                        const marker = new mapboxgl.Marker(el)
                            .setLngLat([event.lng, event.lat])
                            .setPopup(popup)
                            .addTo(map.current);

                        console.log('Marker successfully added');
                        markers.current.push(marker);
                    } catch (error) {
                        console.error('Error creating marker:', error);
                    }
                });
                
                console.log('Total markers created:', markers.current.length);
            }, [loaded, filteredEvents]);

            return (
                <div className="container">
                    <div className="header">
                        <div className="header-content">
                            <div className="header-text">
                                <h1>üåç ‰∏ñÁïåÁ¥õ‰∫â„É™„Ç¢„É´„Çø„Ç§„É†„Éû„ÉÉ„Éó</h1>
                                <p>‰∏ñÁïåÂêÑÂú∞„ÅÆÁ¥õ‰∫â„ÉªÂç±Ê©ü„Çí„É™„Ç¢„É´„Çø„Ç§„É†„ÅßÂèØË¶ñÂåñ</p>
                            </div>
                            <div className="filters">
                                <div className="filter-group">
                                    <label className="filter-label">„Ç´„ÉÜ„Ç¥„É™</label>
                                    <select 
                                        className="filter-select"
                                        value={categoryFilter}
                                        onChange={(e) => setCategoryFilter(e.target.value)}
                                    >
                                        {Object.entries(categories).map(([key, label]) => (
                                            <option key={key} value={key}>{label}</option>
                                        ))}
                                    </select>
                                </div>
                                <div className="filter-group">
                                    <label className="filter-label">Ê∑±ÂàªÂ∫¶</label>
                                    <select 
                                        className="filter-select"
                                        value={severityFilter}
                                        onChange={(e) => setSeverityFilter(e.target.value)}
                                    >
                                        <option value="all">„Åô„Åπ„Å¶</option>
                                        <option value="critical">Á∑äÊÄ•</option>
                                        <option value="high">È´ò</option>
                                        <option value="medium">‰∏≠</option>
                                        <option value="low">‰Ωé</option>
                                    </select>
                                </div>
                                <button 
                                    className={`refresh-btn ${loading ? 'loading' : ''}`}
                                    onClick={loadEvents}
                                    disabled={loading}
                                >
                                    <span>{loading ? 'üîÑ' : 'üîÉ'}</span>
                                    {loading ? 'Êõ¥Êñ∞‰∏≠...' : 'Êõ¥Êñ∞'}
                                </button>
                            </div>
                        </div>
                    </div>
                    <div ref={mapContainer} id="map" />
                    {loaded && (
                        <div className="stats">
                            <span className="stats-number">{filteredEvents.length}</span>
                            ‰ª∂„ÅÆ„Ç§„Éô„É≥„Éà
                        </div>
                    )}
                    <div className={`legend ${legendCollapsed ? 'collapsed' : ''}`}>
                        <button 
                            className="legend-toggle"
                            onClick={() => setLegendCollapsed(false)}
                            aria-label="Âá°‰æã„ÇíÈñã„Åè"
                        >
                            ‚ÑπÔ∏è
                        </button>
                        <div className="legend-content">
                            <button 
                                className="legend-close"
                                onClick={() => setLegendCollapsed(true)}
                                aria-label="Âá°‰æã„ÇíÈñâ„Åò„Çã"
                            >
                                √ó
                            </button>
                            <h3>Ê∑±ÂàªÂ∫¶</h3>
                            <div className="legend-item">
                                <div className="legend-color" style={{background: severityColors.critical}}></div>
                                Á∑äÊÄ• - Âç≥Â∫ß„ÅÆÂØæÂøú„ÅåÂøÖË¶Å
                            </div>
                            <div className="legend-item">
                                <div className="legend-color" style={{background: severityColors.high}}></div>
                                È´ò - Ê∑±Âàª„Å™Áä∂Ê≥Å
                            </div>
                            <div className="legend-item">
                                <div className="legend-color" style={{background: severityColors.medium}}></div>
                                ‰∏≠ - Ê≥®Ë¶ñ„ÅåÂøÖË¶Å
                            </div>
                            <div className="legend-item">
                                <div className="legend-color" style={{background: severityColors.low}}></div>
                                ‰Ωé - ÂÆâÂÆöÂÇæÂêë
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ConflictMap />);
    </script>
</body>
</html>
