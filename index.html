<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∏ñÁïåÁ¥õ‰∫â„Éû„ÉÉ„Éó</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #0a0e27;
            color: #fff;
            overflow: hidden;
        }

        #root {
            width: 100vw;
            height: 100vh;
            height: 100dvh; /* „É¢„Éê„Ç§„É´„Éñ„É©„Ç¶„Ç∂ÂØæÂøú */
        }

        .container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .header {
            background: rgba(10, 14, 39, 0.95);
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            z-index: 2;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 20px;
            flex-wrap: wrap;
        }

        .header-text {
            flex: 1;
            min-width: 200px;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .header p {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
        }

        .filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .filter-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 6px 12px;
            color: #fff;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 120px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 16px;
            padding-right: 32px;
        }

        .filter-select:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .filter-select:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.15);
        }

        .filter-select option {
            background: #1a1f3a;
            color: #fff;
            padding: 8px;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            color: #fff;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .refresh-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .refresh-btn:active {
            transform: translateY(0);
        }

        .refresh-btn.loading {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .stats {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(10, 14, 39, 0.95);
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            z-index: 1;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .stats-number {
            font-size: 20px;
            font-weight: 700;
            color: #fff;
            margin-right: 4px;
        }

        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(10, 14, 39, 0.95);
            padding: 16px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            z-index: 1;
            max-width: calc(100vw - 40px);
        }

        .legend h3 {
            font-size: 13px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            font-size: 12px;
        }

        .legend-item:last-child {
            margin-bottom: 0;
        }

        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 8px;
            flex-shrink: 0;
        }

        #map {
            flex: 1;
            width: 100%;
            touch-action: none; /* „Çø„ÉÉ„ÉÅÊìç‰Ωú„ÇíÊúÄÈÅ©Âåñ */
            cursor: grab; /* „Éâ„É©„ÉÉ„Ç∞ÂèØËÉΩ„Åß„ÅÇ„Çã„Åì„Å®„ÇíÁ§∫„Åô */
        }

        #map:active {
            cursor: grabbing; /* „Éâ„É©„ÉÉ„Ç∞‰∏≠„ÅÆ„Ç´„Éº„ÇΩ„É´ */
        }

        /* „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„Ç≥„É≥„Éà„É≠„Éº„É´„ÅÆ„Çπ„Çø„Ç§„É´Ë™øÊï¥ */
        .mapboxgl-ctrl-top-right {
            top: 80px;
            right: 20px;
        }

        .mapboxgl-ctrl-group {
            background: rgba(10, 14, 39, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .mapboxgl-ctrl-group button {
            background-color: transparent;
            border-color: rgba(255, 255, 255, 0.1);
        }

        .mapboxgl-ctrl-group button + button {
            border-top-color: rgba(255, 255, 255, 0.1);
        }

        .mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon,
        .mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon,
        .mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon {
            background-color: rgba(255, 255, 255, 0.9);
        }

        .mapboxgl-ctrl-group button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .mapboxgl-popup-content {
            background: rgba(10, 14, 39, 0.98);
            color: #fff;
            border-radius: 12px;
            padding: 14px;
            min-width: 260px;
            max-width: calc(100vw - 40px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .mapboxgl-popup-close-button {
            color: #fff;
            font-size: 22px;
            padding: 6px 10px;
            line-height: 1;
        }

        .mapboxgl-popup-close-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .popup-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .popup-location {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 10px;
        }

        .popup-severity {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .popup-description {
            font-size: 13px;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 8px;
        }

        .popup-date {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 8px;
        }

        .marker {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .marker:active {
            transform: scale(1.2);
        }

        .marker-pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        /* „Çø„Éñ„É¨„ÉÉ„ÉàÂØæÂøú */
        @media (min-width: 768px) {
            .header {
                padding: 20px 30px;
            }

            .header h1 {
                font-size: 24px;
                margin-bottom: 8px;
            }

            .header p {
                font-size: 14px;
            }

            .stats {
                top: 90px;
            }

            .legend {
                bottom: 30px;
                right: 30px;
                padding: 20px;
            }

            .legend h3 {
                font-size: 14px;
                margin-bottom: 12px;
            }

            .legend-item {
                font-size: 13px;
                margin-bottom: 8px;
            }

            .legend-color {
                width: 16px;
                height: 16px;
                margin-right: 10px;
            }

            .mapboxgl-popup-content {
                min-width: 280px;
                padding: 16px;
            }

            .popup-title {
                font-size: 16px;
                margin-bottom: 8px;
            }

            .popup-location {
                font-size: 13px;
                margin-bottom: 12px;
            }

            .popup-severity {
                font-size: 12px;
                margin-bottom: 12px;
            }

            .popup-date {
                font-size: 12px;
            }

            .marker:hover {
                transform: scale(1.3);
            }
        }

        /* „Éá„Çπ„ÇØ„Éà„ÉÉ„ÉóÂØæÂøú */
        @media (min-width: 1024px) {
            .legend {
                max-width: 300px;
            }
        }

        /* Â∞è„Åï„Å™„Çπ„Éû„ÉõÂØæÂøú */
        @media (max-width: 360px) {
            .header h1 {
                font-size: 18px;
            }

            .header p {
                font-size: 12px;
            }

            .legend {
                bottom: 15px;
                right: 15px;
                padding: 12px;
            }

            .legend h3 {
                font-size: 12px;
            }

            .legend-item {
                font-size: 11px;
            }

            .popup-title {
                font-size: 14px;
            }
        }

        /* „É©„É≥„Éâ„Çπ„Ç±„Éº„Éó„É¢„Éº„ÉâÔºàÊ®™Âêë„ÅçÔºâÂØæÂøú */
        @media (max-height: 500px) and (orientation: landscape) {
            .header {
                padding: 12px 20px;
            }

            .header h1 {
                font-size: 16px;
                margin-bottom: 2px;
            }

            .header p {
                font-size: 11px;
            }

            .legend {
                bottom: 10px;
                right: 10px;
                padding: 10px;
                font-size: 11px;
            }

            .legend h3 {
                font-size: 11px;
                margin-bottom: 6px;
            }

            .legend-item {
                font-size: 10px;
                margin-bottom: 4px;
            }

            .legend-color {
                width: 12px;
                height: 12px;
                margin-right: 6px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // „Ç§„Éô„É≥„Éà„Ç´„ÉÜ„Ç¥„É™„ÅÆÂÆöÁæ©
        const categories = {
            all: '„Åô„Åπ„Å¶',
            conflict: 'Ê≠¶ÂäõÁ¥õ‰∫â',
            protest: 'ÊäóË≠∞„Éª„Éá„É¢',
            political: 'ÊîøÊ≤ªÁöÑÁ∑äÂºµ',
            humanitarian: '‰∫∫ÈÅìÂç±Ê©ü',
            diplomatic: 'Â§ñ‰∫§ÂïèÈ°å'
        };

        const severityColors = {
            critical: '#ff0040',
            high: '#ff6b00',
            medium: '#ffc107',
            low: '#4caf50'
        };

        const severityLabels = {
            critical: 'Á∑äÊÄ•',
            high: 'È´ò',
            medium: '‰∏≠',
            low: '‰Ωé'
        };

        // Ë§áÊï∞„ÅÆ„Éã„É•„Éº„Çπ„ÇΩ„Éº„Çπ„Åã„ÇâÁµ±ÂêàÂèñÂæóÔºà‰∏ñÁïå‰∏≠„Çí„Ç´„Éê„ÉºÔºâ
        async function fetchGDELTEvents() {
            try {
                console.log('üì° Fetching news from multiple global sources...');
                
                const corsProxy = 'https://api.allorigins.win/raw?url=';
                
                // Ë§áÊï∞„ÅÆRSS„ÇΩ„Éº„ÇπÔºàÂú∞Âüü„Éê„É©„É≥„Çπ„ÇíËÄÉÊÖÆÔºâ
                const sources = [
                    {
                        name: 'Al Jazeera',
                        url: 'https://www.aljazeera.com/xml/rss/all.xml',
                        strength: '‰∏≠Êù±„Éª„Ç¢„Ç∏„Ç¢'
                    },
                    {
                        name: 'BBC World',
                        url: 'https://feeds.bbci.co.uk/news/world/rss.xml',
                        strength: 'ÂÖ®‰∏ñÁïå„Éê„É©„É≥„Çπ'
                    },
                    {
                        name: 'Reuters',
                        url: 'https://www.reutersagency.com/feed/',
                        strength: 'ÂÖ®‰∏ñÁïå„ÉªÈÄüÂ†±'
                    }
                ];
                
                // ÂÖ®„ÇΩ„Éº„Çπ„Åã„Çâ‰∏¶Âàó„ÅßÂèñÂæó
                const allArticles = [];
                
                for (const source of sources) {
                    try {
                        const response = await fetch(corsProxy + encodeURIComponent(source.url));
                        const text = await response.text();
                        const parser = new DOMParser();
                        const xml = parser.parseFromString(text, 'text/xml');
                        const items = xml.querySelectorAll('item');
                        
                        items.forEach((item, index) => {
                            if (index >= 20) return; // ÂêÑ„ÇΩ„Éº„ÇπÊúÄÂ§ß20‰ª∂
                            
                            allArticles.push({
                                title: item.querySelector('title')?.textContent || '',
                                link: item.querySelector('link')?.textContent || '',
                                description: item.querySelector('description')?.textContent || '',
                                pubDate: item.querySelector('pubDate')?.textContent || '',
                                source: source.name
                            });
                        });
                        
                        console.log(`‚úÖ ${source.name}: ${Math.min(20, items.length)} articles`);
                    } catch (err) {
                        console.warn(`‚ö†Ô∏è ${source.name} failed:`, err.message);
                    }
                }
                
                console.log(`üì∞ Total articles fetched: ${allArticles.length}`);
                
                const events = [];
                
                // ‰∏ñÁïå‰∏≠„ÅÆ‰ΩçÁΩÆÊÉÖÂ†±„Éû„ÉÉ„Éî„É≥„Ç∞ÔºàÂ§ßÂπÖÊã°ÂÖÖÔºâ
                const locations = {
                    // „É®„Éº„É≠„ÉÉ„Éë
                    'Ukraine': { lat: 48.3794, lng: 31.1656 },
                    'Kyiv': { lat: 50.4501, lng: 30.5234 },
                    'Russia': { lat: 55.7558, lng: 37.6173 },
                    'Moscow': { lat: 55.7558, lng: 37.6173 },
                    'Paris': { lat: 48.8566, lng: 2.3522 },
                    'France': { lat: 46.2276, lng: 2.2137 },
                    'Germany': { lat: 51.1657, lng: 10.4515 },
                    'UK': { lat: 55.3781, lng: -3.4360 },
                    'Poland': { lat: 51.9194, lng: 19.1451 },
                    
                    // ‰∏≠Êù±
                    'Gaza': { lat: 31.5, lng: 34.45 },
                    'Israel': { lat: 31.0461, lng: 34.8516 },
                    'Palestine': { lat: 31.9522, lng: 35.2332 },
                    'West Bank': { lat: 31.9, lng: 35.2 },
                    'Rafah': { lat: 31.2858, lng: 34.2458 },
                    'Iran': { lat: 32.4279, lng: 53.6880 },
                    'Tehran': { lat: 35.6892, lng: 51.3890 },
                    'Iraq': { lat: 33.2232, lng: 43.6793 },
                    'Baghdad': { lat: 33.3152, lng: 44.3661 },
                    'Syria': { lat: 34.8021, lng: 38.9968 },
                    'Damascus': { lat: 33.5138, lng: 36.2765 },
                    'Lebanon': { lat: 33.8547, lng: 35.8623 },
                    'Beirut': { lat: 33.8886, lng: 35.4955 },
                    'Yemen': { lat: 15.5527, lng: 48.5164 },
                    'Saudi Arabia': { lat: 23.8859, lng: 45.0792 },
                    'Qatar': { lat: 25.3548, lng: 51.1839 },
                    'Doha': { lat: 25.2854, lng: 51.5310 },
                    
                    // „Ç¢„Éï„É™„Ç´
                    'Sudan': { lat: 15.5007, lng: 32.5599 },
                    'Khartoum': { lat: 15.5007, lng: 32.5599 },
                    'Ethiopia': { lat: 9.1450, lng: 40.4897 },
                    'Somalia': { lat: 5.1521, lng: 46.1996 },
                    'Libya': { lat: 26.3351, lng: 17.2283 },
                    'Mali': { lat: 17.5707, lng: -3.9962 },
                    'Nigeria': { lat: 9.0820, lng: 8.6753 },
                    'Kenya': { lat: -0.0236, lng: 37.9062 },
                    'Congo': { lat: -4.0383, lng: 21.7587 },
                    'Zimbabwe': { lat: -19.0154, lng: 29.1549 },
                    
                    // „Ç¢„Ç∏„Ç¢
                    'Myanmar': { lat: 21.9162, lng: 95.9560 },
                    'Afghanistan': { lat: 33.9391, lng: 67.7100 },
                    'Kabul': { lat: 34.5553, lng: 69.2075 },
                    'Pakistan': { lat: 30.3753, lng: 69.3451 },
                    'India': { lat: 20.5937, lng: 78.9629 },
                    'Kashmir': { lat: 34.0837, lng: 74.7973 },
                    'China': { lat: 35.8617, lng: 104.1954 },
                    'Taiwan': { lat: 23.6978, lng: 120.9605 },
                    'North Korea': { lat: 40.3399, lng: 127.5101 },
                    'South Korea': { lat: 37.5665, lng: 126.9780 },
                    'Seoul': { lat: 37.5665, lng: 126.9780 },
                    'Japan': { lat: 36.2048, lng: 138.2529 },
                    'Philippines': { lat: 12.8797, lng: 121.7740 },
                    
                    // ÂçóÂåóÁ±≥ÔºàÈáçÁÇπËøΩÂä†Ôºâ
                    'Venezuela': { lat: 10.4806, lng: -66.9036 },
                    'Caracas': { lat: 10.4806, lng: -66.9036 },
                    'Colombia': { lat: 4.5709, lng: -74.2973 },
                    'Bogota': { lat: 4.7110, lng: -74.0721 },
                    'Brazil': { lat: -14.2350, lng: -51.9253 },
                    'Sao Paulo': { lat: -23.5505, lng: -46.6333 },
                    'Ecuador': { lat: -1.8312, lng: -78.1834 },
                    'Peru': { lat: -9.1900, lng: -75.0152 },
                    'Chile': { lat: -35.6751, lng: -71.5430 },
                    'Argentina': { lat: -38.4161, lng: -63.6167 },
                    'Mexico': { lat: 23.6345, lng: -102.5528 },
                    'Honduras': { lat: 15.2000, lng: -86.2419 },
                    'Haiti': { lat: 18.9712, lng: -72.2852 },
                    'Cuba': { lat: 21.5218, lng: -77.7812 },
                    'United States': { lat: 37.0902, lng: -95.7129 },
                    'USA': { lat: 37.0902, lng: -95.7129 },
                    'Canada': { lat: 56.1304, lng: -106.3468 },
                    
                    // „Ç™„Çª„Ç¢„Éã„Ç¢
                    'Australia': { lat: -25.2744, lng: 133.7751 },
                    'Sydney': { lat: -33.8688, lng: 151.2093 },
                    'New Zealand': { lat: -40.9006, lng: 174.8860 }
                };
                
                // Á¥õ‰∫âÈñ¢ÈÄ£„Ç≠„Éº„ÉØ„Éº„ÉâÔºàÊã°ÂÖÖÔºâ
                const conflictKeywords = [
                    'war', 'conflict', 'attack', 'killed', 'death', 'violence', 
                    'protest', 'crisis', 'military', 'strike', 'bombing', 'airstrike',
                    'coup', 'rebellion', 'insurgency', 'militia', 'armed', 'fighting',
                    'clashes', 'siege', 'blockade', 'invasion', 'occupation'
                ];
                
                allArticles.forEach(article => {
                    const { title, link, description, pubDate, source } = article;
                    const content = (title + ' ' + description).toLowerCase();
                    
                    // Á¥õ‰∫âÈñ¢ÈÄ£„ÅÆ„Åø
                    if (!conflictKeywords.some(kw => content.includes(kw))) {
                        return;
                    }
                    
                    // ‰ΩçÁΩÆÊÉÖÂ†±„ÇíÊäΩÂá∫
                    let locationName = null;
                    let coords = null;
                    
                    for (const [loc, coord] of Object.entries(locations)) {
                        if (title.includes(loc) || description.includes(loc)) {
                            locationName = loc;
                            coords = coord;
                            break;
                        }
                    }
                    
                    if (!coords) return; // ‰ΩçÁΩÆ‰∏çÊòé„ÅØ„Çπ„Ç≠„ÉÉ„Éó
                    
                    // Ê∑±ÂàªÂ∫¶„ÇíÂà§ÂÆö
                    let severity = 'low';
                    if (content.match(/killed|death|massacre|bombing|airstrike|genocide/)) {
                        severity = 'critical';
                    } else if (content.match(/attack|military|war|violence|strike|coup/)) {
                        severity = 'high';
                    } else if (content.match(/protest|tension|dispute|clashes/)) {
                        severity = 'medium';
                    }
                    
                    // „Ç´„ÉÜ„Ç¥„É™„ÇíÂà§ÂÆö
                    let category = 'conflict';
                    if (content.includes('protest') || content.includes('demonstration')) {
                        category = 'protest';
                    } else if (content.includes('humanitarian') || content.includes('refugee') || content.includes('aid')) {
                        category = 'humanitarian';
                    } else if (content.includes('diplomatic') || content.includes('talks') || content.includes('negotiation')) {
                        category = 'diplomatic';
                    } else if (content.includes('political') || content.includes('election') || content.includes('tension')) {
                        category = 'political';
                    }
                    
                    // Êó•‰ªò„Çí„Éï„Ç©„Éº„Éû„ÉÉ„Éà
                    const date = pubDate ? new Date(pubDate).toISOString().split('T')[0] : new Date().toISOString().split('T')[0];
                    
                    events.push({
                        id: events.length + 1,
                        title: title.substring(0, 100),
                        location: locationName,
                        lat: coords.lat,
                        lng: coords.lng,
                        severity: severity,
                        description: description.replace(/<[^>]*>/g, '').substring(0, 200),
                        date: date,
                        category: category,
                        sources: 1,
                        articleUrl: link,
                        sourceName: source
                    });
                });
                
                console.log(`üåç Successfully processed ${events.length} conflict events from ${sources.length} sources`);
                console.log(`üìä Coverage: Middle East, Asia, Africa, Americas, Europe, Oceania`);
                
                return events.length > 0 ? events : getFallbackData();
                
            } catch (error) {
                console.error('‚ùå Error fetching news:', error);
                console.log('üìã Using fallback data...');
                return getFallbackData();
            }
        }
        
        // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÁî®„ÅÆ„ÉÄ„Éü„Éº„Éá„Éº„Çø
        function getFallbackData() {
            return [
                {
                    id: 1,
                    title: "„Éô„Éç„Ç∫„Ç®„É©„ÅßÊîøÊ≤ªÂç±Ê©ü",
                    location: "Caracas",
                    lat: 10.4806,
                    lng: -66.9036,
                    severity: "critical",
                    description: "„Éû„Éâ„Ç•„É≠ÊîøÊ®©Âæå„ÅÆÊ∑∑‰π±„ÅåÁ∂ö„ÅÑ„Å¶„ÅÑ„Åæ„Åô„ÄÇÂõΩÈöõÁ§æ‰ºö„ÅåÊ≥®Ë¶ñ„ÄÇ",
                    date: new Date().toISOString().split('T')[0],
                    category: "political",
                    sources: 12,
                    articleUrl: "https://www.aljazeera.com/news/2026/2/10/venezuela-protests-amnesty-law"
                },
                {
                    id: 2,
                    title: "„Ç¶„ÇØ„É©„Ç§„ÉäÊù±ÈÉ®„ÅßÊøÄ„Åó„ÅÑÊà¶Èóò",
                    location: "Ukraine",
                    lat: 48.0159,
                    lng: 37.8029,
                    severity: "critical",
                    description: "„Éâ„Éç„ÉÑ„ÇØÂú∞Âüü„ÅßÊøÄ„Åó„ÅÑÁ†≤ÊíÉ„ÅåÂ†±Âëä„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇÊ∞ëÈñì„Ç§„É≥„Éï„É©„Å∏„ÅÆË¢´ÂÆ≥„ÅåÊã°Â§ß‰∏≠„ÄÇ",
                    date: new Date().toISOString().split('T')[0],
                    category: "conflict",
                    sources: 45,
                    articleUrl: "https://www.aljazeera.com/news/liveblog/2026/2/12/russia-ukraine-war-list-of-key-events-day-1449"
                },
                {
                    id: 3,
                    title: "„Ç¨„Ç∂Âú∞Âå∫„Åß„ÅÆ‰∫∫ÈÅìÊîØÊè¥",
                    location: "Gaza",
                    lat: 31.5,
                    lng: 34.45,
                    severity: "high",
                    description: "‰∫∫ÈÅìÊîØÊè¥Áâ©Ë≥á„ÅÆÊê¨ÂÖ•„ÅåÈÄ≤Ë°å‰∏≠„ÄÇÂåªÁôÇÊîØÊè¥„ÅåÊÄ•Âãô„Å®„Å™„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                    date: new Date().toISOString().split('T')[0],
                    category: "humanitarian",
                    sources: 56,
                    articleUrl: "https://www.aljazeera.com/news/liveblog/2026/2/11/live-israeli-attacks-target-gaza-west-bank-as-trump-netanyahu-to-meet"
                },
                {
                    id: 4,
                    title: "„Ç≥„É≠„É≥„Éì„Ç¢ÂõΩÂ¢É„ÅßÁ∑äÂºµ",
                    location: "Colombia",
                    lat: 4.5709,
                    lng: -74.2973,
                    severity: "medium",
                    description: "„Éô„Éç„Ç∫„Ç®„É©„Å®„ÅÆÂõΩÂ¢ÉÂú∞Â∏Ø„ÅßÁ∑äÂºµ„ÅåÈ´ò„Åæ„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                    date: new Date().toISOString().split('T')[0],
                    category: "political",
                    sources: 8,
                    articleUrl: "https://www.bbc.com/news/topics/cyx524jx7v7t"
                },
                {
                    id: 5,
                    title: "„Çπ„Éº„ÉÄ„É≥„Åß„ÅÆ‰∫∫ÈÅìÂç±Ê©ü",
                    location: "Sudan",
                    lat: 15.5007,
                    lng: 32.5599,
                    severity: "critical",
                    description: "Ê≠¶Ë£ÖÂã¢ÂäõÈñì„ÅÆË°ùÁ™Å„Å´„Çà„Çä„ÄÅÊï∞‰∏á‰∫∫„ÅåÈÅøÈõ£„Çí‰ΩôÂÑÄ„Å™„Åè„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                    date: new Date().toISOString().split('T')[0],
                    category: "humanitarian",
                    sources: 28,
                    articleUrl: "https://www.bbc.com/news/topics/cnx753jenqxt"
                },
                {
                    id: 6,
                    title: "Âè∞ÊπæÊµ∑Â≥°„Åß„ÅÆÁ∑äÂºµ",
                    location: "Taiwan",
                    lat: 24.5,
                    lng: 120.0,
                    severity: "high",
                    description: "Ëªç‰∫ãÊºîÁøí„ÅåÂÆüÊñΩ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇÂë®Ëæ∫ÂõΩ„ÅåË≠¶Êàí„ÇíÂº∑„ÇÅ„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                    date: new Date().toISOString().split('T')[0],
                    category: "conflict",
                    sources: 67,
                    articleUrl: "https://www.bbc.com/news/topics/c9wpm0zn92gt"
                },
                {
                    id: 7,
                    title: "„Éè„Ç§„ÉÅ„ÅßÊ≤ªÂÆâÊÇ™Âåñ",
                    location: "Haiti",
                    lat: 18.9712,
                    lng: -72.2852,
                    severity: "high",
                    description: "„ÇÆ„É£„É≥„Ç∞Èñì„ÅÆÊö¥Âäõ„ÅåÊøÄÂåñ„ÄÇÂõΩÈöõÁöÑ„Å™ÂÆâÂÆöÂåñÂä™Âäõ„ÅåÁ∂ö„ÅÑ„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                    date: new Date().toISOString().split('T')[0],
                    category: "conflict",
                    sources: 15,
                    articleUrl: "https://www.cfr.org/global-conflict-tracker/conflict/political-instability-haiti"
                },
                {
                    id: 8,
                    title: "„Éü„É£„É≥„Éû„ÉºÂõΩÂ¢É„Åß„ÅÆË°ùÁ™Å",
                    location: "Myanmar",
                    lat: 25.3867,
                    lng: 97.3958,
                    severity: "medium",
                    description: "ÂõΩÂ¢ÉÂú∞Â∏Ø„Åß„ÅÆÂ∞èË¶èÊ®°„Å™Ë°ùÁ™Å„ÅåÂ†±Âëä„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                    date: new Date().toISOString().split('T')[0],
                    category: "conflict",
                    sources: 15,
                    articleUrl: "https://www.bbc.com/news/topics/c207p54m4e3t"
                },
                {
                    id: 9,
                    title: "„Éû„É™„Åß„ÉÜ„É≠ÊîªÊíÉ",
                    location: "Mali",
                    lat: 17.5707,
                    lng: -3.9962,
                    severity: "high",
                    description: "È¶ñÈÉΩ„Éê„Éû„Ç≥„Åß„ÅÆÊîªÊíÉ„ÄÇ„Ç¢„É´„Ç´„Ç§„ÉÄÁ≥ªÁµÑÁπî„ÅÆÊ¥ªÂãï„ÄÇ",
                    date: new Date().toISOString().split('T')[0],
                    category: "conflict",
                    sources: 9,
                    articleUrl: "https://www.crisisgroup.org/crisiswatch"
                },
                {
                    id: 10,
                    title: "„É°„Ç≠„Ç∑„Ç≥ÂõΩÂ¢É„Åß„ÅÆÊö¥Âäõ",
                    location: "Mexico",
                    lat: 25.8,
                    lng: -100.3,
                    severity: "medium",
                    description: "È∫ªËñ¨„Ç´„É´„ÉÜ„É´„Å®„ÅÆÂØæÁ´ã„ÅåÊøÄÂåñ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                    date: new Date().toISOString().split('T')[0],
                    category: "conflict",
                    sources: 23,
                    articleUrl: "https://www.cfr.org/global-conflict-tracker/conflict/criminal-violence-mexico"
                },
            {
                   articleUrl: "https://www.bbc.com/news/topics/c207p54m4e3t"
            }
        ];
    }

    function ConflictMap() {
            const mapContainer = useRef(null);
            const map = useRef(null);
            const markers = useRef([]);
            const [loaded, setLoaded] = useState(false);
            const [events, setEvents] = useState([]);
            const [loading, setLoading] = useState(false);
            const [categoryFilter, setCategoryFilter] = useState('all');
            const [severityFilter, setSeverityFilter] = useState('all');

            // „Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Åï„Çå„Åü„Ç§„Éô„É≥„Éà
            const filteredEvents = events.filter(event => {
                const categoryMatch = categoryFilter === 'all' || event.category === categoryFilter;
                const severityMatch = severityFilter === 'all' || event.severity === severityFilter;
                return categoryMatch && severityMatch;
            });

            // „Ç§„Éô„É≥„Éà„Éá„Éº„Çø„ÇíÂèñÂæó
            const loadEvents = async () => {
                setLoading(true);
                console.log('Loading events...');
                try {
                    const data = await fetchGDELTEvents();
                    console.log('Events loaded:', data.length, 'events');
                    setEvents(data);
                } catch (error) {
                    console.error('„Ç§„Éô„É≥„Éà„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                if (map.current) return;

                // Mapbox„Ç¢„ÇØ„Çª„Çπ„Éà„Éº„ÇØ„É≥
                mapboxgl.accessToken = 'pk.eyJ1IjoieXV1czI0IiwiYSI6ImNtbGpkNnZndzBjc3kzZ29kcGJieGM1amwifQ.D_MBoSrs0EYhqk13xiRBxg';

                map.current = new mapboxgl.Map({
                    container: mapContainer.current,
                    style: 'mapbox://styles/mapbox/dark-v11',
                    center: [40, 25],
                    zoom: window.innerWidth < 768 ? 1.8 : 2.2,
                    projection: 'globe', // Âú∞ÁêÉÂÑÄ„Å´Êàª„Åô
                    attributionControl: false,
                    dragRotate: false,
                    touchZoomRotate: true,
                    touchPitch: false,
                    fadeDuration: 0,
                    pitchWithRotate: false,
                    dragPan: true,
                    keyboard: true,
                    doubleClickZoom: true,
                    scrollZoom: false,
                    boxZoom: false,
                    renderWorldCopies: true,
                    trackResize: true,
                    bearingSnap: 0
                });

                map.current.on('load', () => {
                    setLoaded(true);
                    
                    map.current.addControl(new mapboxgl.NavigationControl({
                        showCompass: false,
                        showZoom: true,
                        visualizePitch: false
                    }), 'top-right');
                    
                    // Âú∞ÁêÉÂÑÄ„ÅÆÈúßÂäπÊûú„ÇíÊàª„Åô
                    map.current.setFog({
                        color: 'rgb(186, 210, 235)',
                        'high-color': 'rgb(36, 92, 223)',
                        'horizon-blend': 0.02,
                        'space-color': 'rgb(11, 11, 25)',
                        'star-intensity': 0.6
                    });
                    
                    // „Éâ„É©„ÉÉ„Ç∞„ÅÆÊÖ£ÊÄß„ÇíÂº∑Âåñ
                    map.current.dragPan.enable({
                        linearity: 0.3,
                        easing: t => t * (2 - t),
                        maxSpeed: 1400,
                        deceleration: 2500
                    });
                    
                    // „Ç´„Çπ„Çø„É†„Éõ„Ç§„Éº„É´„Éè„É≥„Éâ„É©„Éº
                    const mapElement = mapContainer.current;
                    mapElement.addEventListener('wheel', (e) => {
                        // ctrlKeyÔºàMac„Åß„ÅØ‚åòÔºâ„ÅåÊäº„Åï„Çå„Å¶„ÅÑ„Çã„ÄÅ„Åæ„Åü„ÅØ„Éî„É≥„ÉÅ„Ç∏„Çß„Çπ„ÉÅ„É£„Éº„ÅÆÂ†¥Âêà„ÅØ„Ç∫„Éº„É†
                        if (e.ctrlKey || e.metaKey) {
                            e.preventDefault();
                            const zoom = map.current.getZoom();
                            const delta = -e.deltaY / 100; // „Ç∫„Éº„É†Èáè„ÇíË™øÊï¥
                            map.current.zoomTo(zoom + delta, {
                                duration: 0
                            });
                            return;
                        }
                        
                        e.preventDefault();
                        
                        const center = map.current.getCenter();
                        const zoom = map.current.getZoom();
                        
                        // „Çπ„ÇØ„É≠„Éº„É´Èáè„Å´Âü∫„Å•„ÅÑ„Å¶ÁßªÂãïË∑ùÈõ¢„ÇíË®àÁÆó
                        const panFactor = 0.5 / Math.pow(2, zoom);
                        
                        // Á∏¶„Çπ„ÇØ„É≠„Éº„É´Ôºà‰∏ªÔºâ„Å®Ê®™„Çπ„ÇØ„É≠„Éº„É´ÔºàShiftÊäº‰∏ãÊôÇÔºâ„Å´ÂØæÂøú
                        const deltaX = e.shiftKey ? e.deltaY * panFactor : e.deltaX * panFactor;
                        const deltaY = e.shiftKey ? 0 : e.deltaY * panFactor;
                        
                        map.current.panTo([
                            center.lng + deltaX,
                            center.lat - deltaY
                        ], {
                            duration: 0
                        });
                    }, { passive: false });
                    
                    // ÂàùÂõû„Ç§„Éô„É≥„ÉàË™≠„ÅøËæº„Åø
                    loadEvents();
                    
                    console.log('Map loaded, loading events...');
                    
                    // 15ÂàÜ„Åî„Å®„Å´Ëá™ÂãïÊõ¥Êñ∞
                    const autoRefreshInterval = setInterval(() => {
                        console.log('üîÑ Auto-refreshing events (every 15 minutes)...');
                        loadEvents();
                    }, 15 * 60 * 1000); // 15ÂàÜ = 900,000„Éü„É™Áßí
                    
                    // „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÊôÇ„Å´ÈñìÈöî„Çø„Ç§„Éû„Éº„Çí„ÇØ„É™„Ç¢
                    return () => clearInterval(autoRefreshInterval);
                });

                return () => {
                    if (map.current) {
                        map.current.remove();
                    }
                };
            }, []);

            // „Éï„Ç£„É´„Çø„ÉºÂ§âÊõ¥ÊôÇ„Å´„Éû„Éº„Ç´„Éº„ÇíÊõ¥Êñ∞
            useEffect(() => {
                if (!loaded || !map.current) return;

                console.log('Updating markers. Filtered events:', filteredEvents.length);

                // Êó¢Â≠ò„ÅÆ„Éû„Éº„Ç´„Éº„Çí„ÇØ„É™„Ç¢
                markers.current.forEach(marker => marker.remove());
                markers.current = [];

                // „Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Åï„Çå„Åü„Ç§„Éô„É≥„Éà„Å´„Éû„Éº„Ç´„Éº„ÇíËøΩÂä†
                filteredEvents.forEach(event => {
                    console.log('Creating marker for:', event.title, 'at [lng:', event.lng, ', lat:', event.lat, ']');
                    
                    // „Ç∑„É≥„Éó„É´„Å™„Éû„Éº„Ç´„ÉºË¶ÅÁ¥†„Çí‰ΩúÊàêÔºà„Éá„Éê„ÉÉ„Ç∞Áî®Ôºâ
                    const el = document.createElement('div');
                    
                    // „Çπ„Çø„Ç§„É´„ÇíÁõ¥Êé•Ë®≠ÂÆö
                    const size = event.severity === 'critical' ? 40 : 30;
                    
                    Object.assign(el.style, {
                        width: size + 'px',
                        height: size + 'px',
                        backgroundColor: severityColors[event.severity],
                        borderRadius: '50%',
                        border: '3px solid white',
                        cursor: 'pointer',
                        boxShadow: `0 0 20px ${severityColors[event.severity]}`
                    });
                    
                    console.log('Marker element created with size:', size);

                    // „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Çí‰ΩúÊàê
                    const popup = new mapboxgl.Popup({ 
                        offset: 25,
                        closeButton: true,
                        closeOnClick: false,
                        maxWidth: '400px'
                    }).setHTML(`
                        <div class="popup-title">${event.title}</div>
                        <div class="popup-location">üìç ${event.location}</div>
                        <div class="popup-severity" style="background: ${severityColors[event.severity]}">
                            Ê∑±ÂàªÂ∫¶: ${severityLabels[event.severity]}
                        </div>
                        <div class="popup-description">${event.description}</div>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 8px;">
                            „Ç´„ÉÜ„Ç¥„É™: ${categories[event.category]} ‚Ä¢ ${event.sources}‰ª∂„ÅÆ„ÇΩ„Éº„Çπ
                        </div>
                        <div class="popup-date">ÊúÄÁµÇÊõ¥Êñ∞: ${event.date}</div>
                        ${event.articleUrl ? `
                            <a href="${event.articleUrl}" 
                               target="_blank" 
                               rel="noopener noreferrer" 
                               class="article-link"
                               onclick="event.stopPropagation();"
                               style="display: inline-block; margin-top: 12px; padding: 10px 16px; 
                                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                      color: white; text-decoration: none; border-radius: 8px; 
                                      font-size: 13px; font-weight: 600; transition: all 0.2s;
                                      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
                                      cursor: pointer;">
                                üì∞ Ë®ò‰∫ã„ÇíË™≠„ÇÄ ‚Üí
                            </a>
                        ` : ''}
                    `);

                    // Mapbox„Éû„Éº„Ç´„Éº„Çí‰ΩúÊàê
                    try {
                        const marker = new mapboxgl.Marker(el)
                            .setLngLat([event.lng, event.lat])
                            .setPopup(popup)
                            .addTo(map.current);

                        // „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÅåÈñã„ÅÑ„Åü„Å®„Åç„Å´„É™„É≥„ÇØ„Å´„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†
                        marker.getPopup().on('open', () => {
                            const link = document.querySelector('.article-link');
                            if (link) {
                                link.addEventListener('click', (e) => {
                                    e.stopPropagation();
                                    // „É™„É≥„ÇØ„ÅÆ„Éá„Éï„Ç©„É´„ÉàÂãï‰Ωú„ÅØÁ∂≠ÊåÅÔºàÊñ∞„Åó„ÅÑ„Çø„Éñ„ÅßÈñã„ÅèÔºâ
                                });
                                
                                // „Éõ„Éê„Éº„Ç®„Éï„Çß„ÇØ„Éà
                                link.addEventListener('mouseenter', (e) => {
                                    e.target.style.transform = 'translateY(-2px)';
                                    e.target.style.boxShadow = '0 4px 12px rgba(102, 126, 234, 0.5)';
                                });
                                link.addEventListener('mouseleave', (e) => {
                                    e.target.style.transform = 'translateY(0)';
                                    e.target.style.boxShadow = '0 2px 8px rgba(102, 126, 234, 0.3)';
                                });
                            }
                        });

                        console.log('Marker successfully added');
                        markers.current.push(marker);
                    } catch (error) {
                        console.error('Error creating marker:', error);
                    }
                });
                
                console.log('Total markers created:', markers.current.length);
            }, [loaded, filteredEvents]);

            return (
                <div className="container">
                    <div className="header">
                        <div className="header-content">
                            <div className="header-text">
                                <h1>üåç ‰∏ñÁïåÁ¥õ‰∫â„É™„Ç¢„É´„Çø„Ç§„É†„Éû„ÉÉ„Éó</h1>
                                <p>‰∏ñÁïåÂêÑÂú∞„ÅÆÁ¥õ‰∫â„ÉªÂç±Ê©ü„Çí„É™„Ç¢„É´„Çø„Ç§„É†„ÅßÂèØË¶ñÂåñ</p>
                            </div>
                            <div className="filters">
                                <div className="filter-group">
                                    <label className="filter-label">„Ç´„ÉÜ„Ç¥„É™</label>
                                    <select 
                                        className="filter-select"
                                        value={categoryFilter}
                                        onChange={(e) => setCategoryFilter(e.target.value)}
                                    >
                                        {Object.entries(categories).map(([key, label]) => (
                                            <option key={key} value={key}>{label}</option>
                                        ))}
                                    </select>
                                </div>
                                <div className="filter-group">
                                    <label className="filter-label">Ê∑±ÂàªÂ∫¶</label>
                                    <select 
                                        className="filter-select"
                                        value={severityFilter}
                                        onChange={(e) => setSeverityFilter(e.target.value)}
                                    >
                                        <option value="all">„Åô„Åπ„Å¶</option>
                                        <option value="critical">Á∑äÊÄ•</option>
                                        <option value="high">È´ò</option>
                                        <option value="medium">‰∏≠</option>
                                        <option value="low">‰Ωé</option>
                                    </select>
                                </div>
                                <button 
                                    className={`refresh-btn ${loading ? 'loading' : ''}`}
                                    onClick={loadEvents}
                                    disabled={loading}
                                >
                                    <span>{loading ? 'üîÑ' : 'üîÉ'}</span>
                                    {loading ? 'Êõ¥Êñ∞‰∏≠...' : 'Êõ¥Êñ∞'}
                                </button>
                            </div>
                        </div>
                    </div>
                    <div ref={mapContainer} id="map" />
                    {loaded && (
                        <div className="stats">
                            <span className="stats-number">{filteredEvents.length}</span>
                            ‰ª∂„ÅÆ„Ç§„Éô„É≥„Éà
                        </div>
                    )}
                    <div className="legend">
                        <h3>Ê∑±ÂàªÂ∫¶</h3>
                        <div className="legend-item">
                            <div className="legend-color" style={{background: severityColors.critical}}></div>
                            Á∑äÊÄ• - Âç≥Â∫ß„ÅÆÂØæÂøú„ÅåÂøÖË¶Å
                        </div>
                        <div className="legend-item">
                            <div className="legend-color" style={{background: severityColors.high}}></div>
                            È´ò - Ê∑±Âàª„Å™Áä∂Ê≥Å
                        </div>
                        <div className="legend-item">
                            <div className="legend-color" style={{background: severityColors.medium}}></div>
                            ‰∏≠ - Ê≥®Ë¶ñ„ÅåÂøÖË¶Å
                        </div>
                        <div className="legend-item">
                            <div className="legend-color" style={{background: severityColors.low}}></div>
                            ‰Ωé - ÂÆâÂÆöÂÇæÂêë
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ConflictMap />);
    </script>
</body>
</html>
